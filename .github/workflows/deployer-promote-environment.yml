###############################################################################
# ---------------------- DO NOT EDIT THIS FILE !!!-----------------------------
#
# This file is generated by Deployer K8s PaaS ControlPlane.
# Any changes to this file can be overwritten at any time by the ControlPlane.
#
###############################################################################
name: Deployer Promote Environment

on:
  workflow_dispatch:
    inputs:
      app_name:
        description: 'Application name'
        required: true
        type: string
      source_env:
        description: 'Source environment'
        required: true
        type: choice
        options:
          - dev
          - stg
      source_region:
        description: 'Source AWS region'
        required: true
        type: choice
        options:
          - us-east-1
          - eu-central-1
        default: us-east-1
      target_env:
        description: 'Target environment'
        required: true
        type: choice
        options:
          - stg
          - prod
      target_region:
        description: 'Target AWS region'
        required: true
        type: choice
        options:
          - us-east-1
          - eu-central-1
        default: us-east-1

permissions:
  contents: write
  pull-requests: write

concurrency:
  group: deployer-promote-${{ inputs.app_name }}-${{ inputs.target_env }}-${{ inputs.target_region }}
  cancel-in-progress: true

jobs:
  promote:
    name: Promote ${{ inputs.app_name }} to ${{ inputs.target_env }}-${{ inputs.target_region }}
    runs-on: gh-larger-linux-mini

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Run Deployer Promote
        id: promote
        uses: McK-Internal/lrah-control-plane/.github/actions/promote-envs@v1.19.0
        with:
          app_name: ${{ inputs.app_name }}
          source_env: ${{ inputs.source_env }}
          source_region: ${{ inputs.source_region }}
          target_env: ${{ inputs.target_env }}
          target_region: ${{ inputs.target_region }}
          github_token: ${{ secrets.GITHUB_TOKEN }}

      - name: Display results
        if: success()
        run: |
          echo "âœ… Promotion completed successfully!"
          echo ""
          echo "ðŸ“‹ PR Created:"
          echo "   â€¢ URL: ${{ steps.promote.outputs.pr_url }}"
          echo "   â€¢ Number: #${{ steps.promote.outputs.pr_number }}"
          echo ""
          echo "ðŸ”„ Next Steps:"
          echo "   1. Review the PR at ${{ steps.promote.outputs.pr_url }}"
          echo "   2. Verify configurations are correct"
          echo "   3. Make any manual adjustments if needed"
          echo "   4. Merge the PR when ready"
