###############################################################################
# ---------------------- DO NOT EDIT THIS FILE !!!-----------------------------
#
# This file is generated by Deployer K8s PaaS ControlPlane.
# Any changes to this file can be overwritten at any time by the ControlPlane.
#
###############################################################################
name: citizen-dev7-dev-us-Sync Argo app

on:
  workflow_dispatch:
    inputs:
      prune_resources:
        description: 'Delete resources before creation. Type "*prune*" to confirm'
        type: string
        required: true
        default: 'no'

jobs:
  load-environment-vars:
    name: environment-context
    runs-on: [gh-larger-linux-mini]
    environment: "citizen-dev7-dev-us-east-1"
    outputs:
      CLUSTER_LOGIN_URL: ${{ vars.KUBERNETES_CLUSTER_LOGIN_URL }}
      KUBERNETES_NAMESPACE_NAME: ${{ vars.KUBERNETES_NAMESPACE_NAME }}

    steps:
      - name: Run
        id: setup-env
        run: |
          echo "Setup environment specific variables"
          echo "CLUSTER_LOGIN_URL: ${{ vars.KUBERNETES_CLUSTER_LOGIN_URL}}"
          echo "KUBERNETES_NAMESPACE_NAME: ${{ vars.KUBERNETES_NAMESPACE_NAME }}"

  sync-argo-app:
    name: ArgoCD application
    needs: [load-environment-vars]
    uses: McK-Internal/lrah-control-plane/.github/workflows/lrah-reusable-sync-argo-app.yaml@v1.21.0
    with:
      cluster_login_url: ${{ needs.load-environment-vars.outputs.CLUSTER_LOGIN_URL }}
      kubernetes_namespace_name: ${{ needs.load-environment-vars.outputs.KUBERNETES_NAMESPACE_NAME }}
      prune_resources: ${{ github.event.inputs.prune_resources }}
